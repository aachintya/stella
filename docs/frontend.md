# Frontend Overview

The frontend lives in `apps/web-frontend/src/`. It's a Vue 2 app that talks to
the Stellarium Web Engine and wraps it for mobile via Capacitor.

---

## Engine Boundary

The engine is a WebAssembly module exposed as `$stel` on the Vue instance.

To read engine state:
```javascript
this.$store.state.stel.constellations.lines_visible
```

To write engine state:
```javascript
this.$stel.core.constellations.lines_visible = true
```

The Vuex store mirrors the engine state via `replaceStelWebEngine`. This keeps
Vue's reactivity in sync with the engine. You read from the store, write to the
engine directly.

---

## Services

These are standalone modules in `assets/` that handle platform features. Some examples are:

| Service | File | What it does |
|---------|------|--------------|
| Gyroscope | `gyroscope-service.js` | Device orientation → sky view |
| Camera | `camera-service.js` | Camera feed for AR mode |
| Fullscreen | `fullscreen-service.js` | Android immersive mode |
| Search | `search_engine.js` | Sky object search with filters |

Services are typically initialized in `App.vue` and accessed globally or
through the Vuex store.

---

## State Management

The Vuex store (`store/index.js`) holds two kinds of state:

**Engine state** — mirrored from the WASM engine:
```javascript
state.stel = {
  constellations: { lines_visible: true, ... },
  atmosphere: { visible: true },
  ...
}
```

**App state** — things the engine doesn't know about:
```javascript
state.gyroModeActive = false
state.arModeActive = false
state.sensorsEnabled = true
```

Mutations like `setGyroModeActive` update app state. The engine state is
updated by writing to `$stel.core.*` and gets synced back via the watcher.

---

## Component Patterns

### Bottom Menu

The bottom menu (`components/bottom-menu/`) uses a pattern where:

* **Tap** toggles a feature on/off.
* **Long-press** opens a submenu with detailed settings.

Each submenu is a separate component (e.g., `ConstellationsSubmenu.vue`) that
uses `BottomMenuSubmenu.vue` as a wrapper.

### Settings Panel

`settings-panel.vue` is a slide-out drawer with display options. Most settings
are two-way bindings to engine properties:

```javascript
constellationLines: {
  get() { return this.$stel.core.constellations.lines_visible },
  set(val) { this.$stel.core.constellations.lines_visible = val }
}
```

Includes: atmosphere, grids, constellation art, star rendering, light pollution
(Bortle scale), and sky culture selection.

### Search

The search panel (`components/search-panel.vue`) uses `search_engine.js` for
querying sky objects.

**How it works:**

1. User types a query.
2. `querySkySources()` searches in priority order:
   - Constellations (highest)
   - Planets
   - Stars
   - DSOs (lowest)
3. Results are deduplicated and ranked (exact → starts-with → contains).

**The name index:**

We prebuilt a name index with ~60k objects (stars + DSOs). It lives at
`public/skydata/name_index_compact.json` and gets lazy-loaded on first search.

Stars without proper names use `HIP <number>` format. DSOs include Messier,
NGC, IC, and common names.

The index is generated by `scripts/create_name_index.py` from the `.eph` files.

**Filters:**

Users can filter by category (planets, stars, DSOs, satellites, etc.).
Favourites and recents are stored in localStorage.

### Overlays

Components like `GyroDirectionOverlay.vue` and `AR-camera-preview.vue` are
conditionally rendered based on store state. They sit on top of the canvas
and don't interfere with engine rendering.